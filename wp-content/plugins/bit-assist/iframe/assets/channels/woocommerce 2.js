const woocommerce={renderWooCommerce(e){const t=this;t.hideChannels(),t.renderCard(),t.setCardStyle(e.config);const l=e.config?.card_config;t.formBody=createElm("form",{id:"formBody",method:"POST"});const o=createElm("div",{id:"dynamicFields"}),s=createElm("input",{type:"hidden",name:"widget_channel_id",value:e.id}),a=createElm("button",{type:"submit"});globalInnerText(a,l?.submit_button_text),globalAppend(t.formBody,[o,s,a]),globalInnerHTML(t.cardBody,""),globalAppend(t.cardBody,t.formBody),globalEventListener(t.formBody,"submit",(l=>woocommerce.formSubmitted(t,l,e))),t.createAllFields(l?.form_fields)},createAllFields(e){const t=$("#dynamicFields");e?.forEach((e=>{woocommerce.createTextField(e,t)}))},createTextField(e,t){const l=createElm("input"),o=e.field_type,s=o.includes("_")?o.split("_")[1]:o;globalSetAttribute(l,"name",`${s}`),globalSetAttribute(l,"placeholder",e.label+(e.required?"":" (optional)")),e.required&&globalSetAttribute(l,"required",""),globalClassListAdd(l,"formControl"),globalSetAttribute(l,"type",o),globalAppend(t,l)},async formSubmitted(e,t,l){t.preventDefault();const o=t.target.querySelector('[type="submit"]'),s=o.innerText,a=new FormData(t.target);try{globalInnerText(o,"Sending..."),globalClassListAdd(o,"disabled");const i=await fetch(`${e.apiEndPoint}/responses`,{method:"POST",body:a}).then((e=>e.json()));"success"===i?.status?this.formSubmittedData(e,a,l):await woocommerce.showToast(e,"error",i?.data,l),t.target.reset(),globalQuerySelectorAll(t.target,".cfit-title").forEach((e=>{globalInnerText(e,"No file chosen")})),globalClassListRemove(o,"disabled"),globalInnerText(o,s)}catch(t){console.log(t),await woocommerce.showToast(e,"error"),globalClassListRemove(o,"disabled"),globalInnerText(o,s)}},async formSubmittedData(e,t,l,o=1){t.set("page",o);const s=await fetch(`${e.apiEndPoint}/orderDetails`,{method:"POST",body:t}).then((e=>e.json()));"success"===s.status&&await woocommerce.showToast(e,"success",s?.data,l,t)},async showToast(e,t,l,o,s){if(200===l?.status_code)return this.orderDetailsItems(e,l,o),void((l?.pagination?.has_next||l?.pagination?.has_previous)&&this.renderOrderDetailsPagination(e,l?.pagination,s,o));const a=createElm("div",{class:`toast ${t}`}),i=createElm("div",{class:"toast-content"}),r=createElm("div",{class:"toast-text"}),n=createElm("div",{class:"toast-text-title"});n.innerText="success"===t?"404":"Error";const d=createElm("div",{class:"toast-text-body"});d.innerText="success"===t?l?.message:"Something went wrong",globalAppend(r,[n,d]),globalAppend(i,r),globalAppend(a,i),globalAppend(e.cardBody,a),globalClassListAdd(e.formBody,"hide"),globalClassListContains(a,"success")&&(n.style.color=e.selectedFormBg),await e.delay(2),globalClassListContains(e.formBody,"hide")&&(e.cardBody.removeChild(a),globalClassListRemove(e.formBody,"hide"))},orderDetailsItems(e,t,l){const o=createElm("div",{id:"orderDetailsBody"}),s=createElm("div",{id:"listWrapper"}),a=createElm("div",{id:"lists"});globalAppend(s,a);const i=createElm("div",{id:"orderDetailsDescription"}),r=createElm("div",{class:"descriptionTitle"}),n=createElm("button",{class:"iconBtn closeDescBtn",title:"Back"});globalInnerHTML(n,'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15 15" fill="#000"><path d="M7.088 14.176a7.09 7.09 0 0 0 7.088-7.088A7.09 7.09 0 0 0 7.088 0 7.09 7.09 0 0 0 0 7.088a7.09 7.09 0 0 0 7.088 7.088z" fill-opacity=".1"/><path d="M8.47 10.122c.135 0 .269-.05.376-.156.099-.1.154-.235.154-.376s-.055-.276-.154-.376L6.719 7.088l2.126-2.126c.099-.1.154-.235.154-.376s-.055-.276-.154-.376c-.206-.206-.546-.206-.751 0L5.592 6.712c-.206.206-.206.546 0 .751l2.502 2.502c.106.106.241.156.376.156h0z"/></svg>');const d=createElm("p");globalAppend(r,[n,d]);const c=createElm("div",{class:"content"});globalAppend(i,[r,c]),globalAppend(o,[s,i]),globalInnerHTML(e.cardBody,""),globalAppend(e.cardBody,o);const g=l?.config?.order_details;1!==t.items.length?(globalEventListener(n,"click",(t=>woocommerce.orderDetailsDescToggle(e,t))),woocommerce.renderWooCommerceItem(e,t,g)):woocommerce.singleItemContentShow(e,g,t)},singleItemContentShow(e,t,l){const o=l.items[0],s=$("#orderDetailsBody");s.removeChild($("#listWrapper")),s.removeChild($("#orderDetailsDescription"));const a=createElm("div",{id:"singleItemContent"}),i=createElm("p",{class:"descriptionTitle title"});globalInnerHTML(i,o.order_id?"Order Id: "+o.order_id+` (${o.shipping_status})`:"");const r=createElm("div",{class:"content"});globalAppend(a,[i,r]),globalAppend(s,a),woocommerce.showContent(t,o),e.resetClientWidgetSize()},renderWooCommerceItem(e,t,l){e.itemListAppend(t.items),globalQuerySelectorAll(document,".listItemTitleWrapper").forEach((o=>{globalEventListener(o,"click",(o=>{woocommerce.orderDetailsDescToggle(e,o,t,l)}))})),e.resetClientWidgetSize()},orderDetailsDescToggle(e,t,l,o){if(l){const e=l.items.find((e=>Number(e.order_id)===Number(t.target.closest(".listItemTitleWrapper").dataset.item_id)));globalInnerHTML($(".descriptionTitle p"),"Order Id: "+e?.order_id||""),woocommerce.showContent(o,e)}const s=$("#orderDetailsBody");if(globalClassListToggle($("#orderDetailsBody"),"openDesc")){const e=$("#orderDetailsDescription").scrollHeight;Object.assign(s.style,{height:e>400?"400px":`${e}px`,overflow:e>400?"auto":"initial"})}else s.removeAttribute("style");globalClassListToggle($("#listWrapper"),"hide"),e.resetClientWidgetSize()},showContent(e,t){let l="";e?.filter(Boolean).forEach((e=>{const o=e.split("_").map((e=>e.charAt(0).toUpperCase()+e.slice(1).toLowerCase())).join(" ");let s=t[e];"string"==typeof s&&(s=s.split("-").map((e=>e.charAt(0).toUpperCase()+e.slice(1).toLowerCase())).join(" ")),l+=`${o}: ${s}<br>`})),globalInnerHTML($(".content"),l),$(".content").style.fontSize="1rem",$(".content").style.lineHeight="2"},renderOrderDetailsPagination(e,t,l,o){const s=createElm("div",{class:"pagination"}),a=createElm("span",{class:"pageNumber"});globalInnerText(a,`${t?.current} / ${t?.total} page`);const i=createElm("button",{class:"nextPage"});globalInnerText(i,"Next"),t?.has_next||globalSetAttribute(i,"disabled","");const r=createElm("button",{class:"prevPage"});globalInnerText(r,"Prev"),t?.has_previous||globalSetAttribute(r,"disabled",""),globalEventListener(i,"click",(()=>this.formSubmittedData(e,l,o,t?.next))),globalEventListener(r,"click",(()=>this.formSubmittedData(e,l,o,t?.previous))),globalAppend(s,[r,i,a]),globalAppend($("#lists"),s),e.resetClientWidgetSize()}};export{woocommerce};
