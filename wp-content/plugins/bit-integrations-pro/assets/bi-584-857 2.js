var S=Object.defineProperty,$=Object.defineProperties;var v=Object.getOwnPropertyDescriptors;var I=Object.getOwnPropertySymbols;var q=Object.prototype.hasOwnProperty,z=Object.prototype.propertyIsEnumerable;var k=(e,s,t)=>s in e?S(e,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[s]=t,n=(e,s)=>{for(var t in s||(s={}))q.call(s,t)&&k(e,t,s[t]);if(I)for(var t of I(s))z.call(s,t)&&k(e,t,s[t]);return e},p=(e,s)=>$(e,v(s));var y=(e,s,t)=>new Promise((i,l)=>{var r=c=>{try{a(t.next(c))}catch(m){l(m)}},o=c=>{try{a(t.throw(c))}catch(m){l(m)}},a=c=>c.done?i(c.value):Promise.resolve(c.value).then(r,o);a((t=t.apply(e,s)).next())});import{_ as d,a as u,b as F}from"./bi-490-178.js";import{e as A,s as R}from"./bi-266-720.js";const D=(e,s,t,i,l)=>{const r=n({},s),o=n({},i),{name:a,value:c}=e.target;o[a]="",r[a]=c,l(o),t(r)},U=(e,s,t,i,l,r,o)=>{if(!e.clientId||!e.clientSecret){i({clientId:e.clientId?"":d("Client Id can't be empty"),clientSecret:e.clientSecret?"":d("Client Secret can't be empty")});return}i({}),o(p(n({},r),{auth:!0}));const a=`https://api.notion.com/v1/oauth/authorize?client_id=${e.clientId}&response_type=code&owner=user&state=${encodeURIComponent(window.location.href)}/redirect&redirect_uri=${encodeURIComponent(`${btcbi.api.base}`)}/redirect`,c=window.open(a,"Notion","width=400,height=609,toolbar=off"),m=setInterval(()=>{if(c.closed){clearInterval(m);let f={},h=!1;const _=localStorage.getItem("__notion");if(_&&(h=!0,f=JSON.parse(_),localStorage.removeItem("__notion")),!f.code||f.error||!f||!h){const b=f.error?`Cause: ${f.error}`:"";u.error(`${d("Authorization failed","bit-integrations")} ${b}. ${d("please try again","bit-integrations")}`),o(p(n({},r),{auth:!1}))}else C(f,e,s,l,r,o)}},500)},C=(e,s,t,i,l,r)=>{const o=n({},e);o.clientId=s.clientId,o.clientSecret=s.clientSecret,o.redirectURI=`${btcbi.api.base}/redirect`,F(o,"notion_authorization").then(a=>{if(a&&a.success){const c=n({},s);c.tokenDetails=a.data,t(c),i(!0),u.success(d("Authorized Successfully"))}else a&&a.data&&a.data.data||!a.success&&typeof a.data=="string"?u.error(`${d("Authorization failed Cause:")}${a.data.data||a.data}. ${d("please try again")}`):u.error(d("Authorization failed. please try again"));r(p(n({},l),{auth:!1}))})},x=(e,s,t,i)=>y(void 0,null,function*(){i&&i(p(n({},t),{list:!0}));const l={accessToken:e.tokenDetails.access_token},r=yield F(l,"notion_database_lists");if(r.success&&r.data.results){const o=r==null?void 0:r.data.results.filter(c=>c.object==="database").map(c=>({id:c.id,name:c.title[0].text.content})),a=n({},e);return o&&(a.default||(a.default={}),a.default.databaseLists=o,s(a),i&&(i(p(n({},t),{list:!1})),u.success(d("List refresh successfully")))),!0}return i&&(i(p(n({},t),{list:!1})),u.success(d("List refresh failed"))),!1}),N=(e,s,t,i)=>y(void 0,null,function*(){i&&i(p(n({},t),{field:!0}));const l={accessToken:e.tokenDetails.access_token,databaseId:e.databaseId},r=yield F(l,"notion_database_properties");if(r.success&&r.data.properties){const o=r==null?void 0:r.data.properties,a=[],c=["formula","people","Rollup","Relation","created_by","created_time","last_edited_by","last_edited_time"];for(const f in o){const h={},b=o[f].type;c.includes(b)||(h.label=f,h.key=b,b=="title"?h.required=!0:h.required=!1,a.push(h))}const m=n({},e);return o&&(m.notionFields=a,s(n({},m)),i&&(i(p(n({},t),{field:!1})),u.success(d("field refresh successfully")))),a}return i&&(i(p(n({},t),{field:!1})),u.success(d("field refresh failed"))),!1}),M=e=>{const s=e==null?void 0:e.notionFields.filter(t=>t.required===!0);return s.length>0?s.map(t=>({formFields:"",notionFormFields:t.label})):[{formFields:"",notionFormFields:""}]},w=e=>!((e!=null&&e.field_map?e.field_map.filter(t=>!t.formFields||!t.notionFormFields||!t.formFields==="custom"&&!t.customValue):[]).length>0),V=(e,s,t)=>{if(!w(e)){u.error("Please map mandatory fields");return}e.field_map.length>0&&s(t),document.querySelector(".btcd-s-wrp").scrollTop=0},j=(e,s,t,i,l,r)=>{r(!0),A(e,s,t,i,l,"","",r).then(a=>{var c;a.success?(u.success((c=a.data)==null?void 0:c.msg),l.push(t)):u.error(a.data||a)})},E=(e,s,t,i,l,r)=>{if(!w(t)){u.error("Please map mandatory fields");return}R({flow:e,allIntegURL:s,conf:t,history:i,edit:l,setIsLoading:r})};export{x as a,N as b,U as c,j as d,M as g,D as h,V as n,E as s};
