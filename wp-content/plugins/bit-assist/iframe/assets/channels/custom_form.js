const custom_form={renderForm(e){const t=this;t.hideChannels(),t.renderCard(),t.setCardStyle(e.config);const l=e.config?.card_config;t.formBody=createElm("form",{id:"formBody",method:"POST"});const a=createElm("div",{id:"dynamicFields"}),o=createElm("input",{type:"hidden",name:"widget_channel_id",value:e.id}),r=createElm("button",{type:"submit"});globalInnerText(r,l?.submit_button_text),globalAppend(t.formBody,[a,o,r]),globalInnerHTML(t.cardBody,""),globalAppend(t.cardBody,t.formBody),globalEventListener(t.formBody,"submit",(e=>custom_form.formSubmitted(t,e))),t.createAllFields(l?.form_fields)},createAllFields(e){const t=$("#dynamicFields");let l=!1;e?.forEach((e=>{"file"!==e.field_type||l||(globalSetAttribute($("#formBody"),"enctype","multipart/form-data"),l=!0),"rating"===e.field_type?custom_form.createRatingField(e,t,"rating"):"feedback"===e.field_type?custom_form.createRatingField(e,t,"feedback"):custom_form.createTextField(e,t)}))},createRatingField(e,t,l){const a=Math.floor(1e8*Math.random()),o=e.label.toLowerCase().replace(/ /g,"_"),r=createElm("div",{class:l});"rating"===l&&globalClassListAdd(r,e.rating_type);let s=[];s="feedback"===l?["bug","suggest","love"]:"star"===e.rating_type?["5 star","4 star","3 star","2 star","1 star"]:["sad","confused","happy"],s.forEach((t=>{const s=`${o}_${t.replace(/ /g,"_")}_${a}`,i=createElm("input",{type:"radio",name:o,value:t,id:s});e.required&&globalSetAttribute(i,"required","");const n=createElm("label",{title:t,for:s,class:t});if("feedback"===l){globalInnerHTML(n,`${t.charAt(0).toUpperCase()+t.slice(1)}`);const e=createElm("div",{class:"feedback-icon"});n.prepend(e)}globalAppend(r,[i,n])})),globalAppend(t,r)},createTextField(e,t){const l=createElm("textarea"===e.field_type?"textarea":"input");globalSetAttribute(l,"name",`${e.label.toLowerCase().replace(/ /g,"_")}${e?.allow_multiple?"[]":""}`),globalSetAttribute(l,"placeholder",e.label+(e.required?"":" (optional)")),e.required&&globalSetAttribute(l,"required",""),"GDPR"!==e.field_type?(globalClassListAdd(l,"formControl"),globalSetAttribute(l,"type",e.field_type),"file"!==e.field_type?globalAppend(t,l):custom_form.fileField(e,t,l)):custom_form.gdprField(e,t,l)},fileField(e,t,l){e?.allow_multiple&&globalSetAttribute(l,"multiple","");const a=createElm("div",{class:"formControl customFile"}),o=createElm("div",{class:"cfit"}),r=createElm("button",{class:"cfit-btn",type:"button"});globalInnerText(r,"Attach File");const s=createElm("div",{class:"cfit-title"});globalInnerText(s,"No file chosen"),globalAppend(o,[r,s]),globalAppend(a,[o,l]),globalAppend(t,a),globalEventListener(r,"click",(()=>l.click())),globalEventListener(l,"change",(function(e){let t="No file chosen";const l=e.target.files.length;l>0&&(t=1===l?e.target.files[0].name:`${l} files`),globalInnerText(s,t)}))},gdprField(e,t,l){globalSetAttribute(l,"type","checkbox");const a=createElm("a",{target:"_blank"});globalInnerHTML(a,e.label),e?.url&&(a.href=e.url);const o=createElm("div",{class:"gdprContainer"});globalAppend(o,[l,a]),globalAppend(t,o)},async formSubmitted(e,t){t.preventDefault();const l=t.target.querySelector('[type="submit"]'),a=l.innerText,o=new FormData(t.target);try{globalInnerText(l,"Sending..."),globalClassListAdd(l,"disabled");const r=await fetch(`${e.apiEndPoint}/responses`,{method:"POST",body:o}).then((e=>e.json()));"success"===r?.status?await custom_form.showToast(e,"success",r?.data):await custom_form.showToast(e,"error",r?.data),t.target.reset(),globalQuerySelectorAll(t.target,".cfit-title").forEach((e=>{globalInnerText(e,"No file chosen")})),globalClassListRemove(l,"disabled"),globalInnerText(l,a)}catch(o){console.log(o),await custom_form.showToast(e,"error"),t.target.reset(),globalQuerySelectorAll(t.target,".cfit-title").forEach((e=>{globalInnerText(e,"No file chosen")})),globalClassListRemove(l,"disabled"),globalInnerText(l,a)}},async showToast(e,t,l){if(!e.cardBody.contains(e.formBody))return;const a=createElm("div",{class:`toast ${t}`}),o=createElm("div",{class:"toast-content"}),r=createElm("div",{class:"toast-text"}),s=createElm("div",{class:"toast-text-title"});s.innerText="success"===t?"Success":"Error";const i=createElm("div",{class:"toast-text-body"});i.innerText="success"===t?l:"Something went wrong",globalAppend(r,[s,i]),globalAppend(o,r),globalAppend(a,o),globalAppend(e.cardBody,a),globalClassListAdd(e.formBody,"hide"),globalClassListContains(a,"success")&&(s.style.color=e.selectedFormBg),await e.delay(2),globalClassListContains(e.formBody,"hide")&&(e.cardBody.removeChild(a),globalClassListRemove(e.formBody,"hide"))}};export{custom_form};
