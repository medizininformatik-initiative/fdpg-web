var y=Object.defineProperty,_=Object.defineProperties;var b=Object.getOwnPropertyDescriptors;var m=Object.getOwnPropertySymbols;var g=Object.prototype.hasOwnProperty,K=Object.prototype.propertyIsEnumerable;var p=(e,s,t)=>s in e?y(e,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[s]=t,u=(e,s)=>{for(var t in s||(s={}))g.call(s,t)&&p(e,t,s[t]);if(m)for(var t of m(s))K.call(s,t)&&p(e,t,s[t]);return e},f=(e,s)=>_(e,b(s));import{_ as o,b as F,a as n}from"./bi-490-178.js";import{e as q,s as A}from"./bi-266-720.js";const w=(e,s,t)=>{const a=u({},s),{name:r}=e.target;e.target.value!==""?a[r]=e.target.value:delete a[r],t(u({},a))},x=(e,s,t,a,r,i)=>{if(!e.authKey){t({authKey:e.authKey?"":o("API key can't be empty","bit-integrations")});return}t({}),i(f(u({},r),{auth:!0}));const c={authKey:e.authKey};F(c,"klaviyo_handle_authorize").then(l=>{if(l&&l.success){const d=u({},e);l.data&&(d.default||(d.default={}),d.default.lists=l.data),s(d),a(!0),i(f(u({},r),{auth:!1})),n.success(o("Authorized successfully","bit-integrations"));return}i(f(u({},r),{auth:!1})),n.error(o("Authorized failed","bit-integrations"))})},M=(e,s,t,a)=>{a(f(u({},t),{list:!0}));const r={authKey:e.authKey};F(r,"klaviyo_handle_authorize").then(i=>{if(i&&i.success){const c=u({},e);i.data&&(c.default||(c.default={}),c.default.lists=i.data),s(c),a(f(u({},t),{list:!1})),n.success(o("List refresh successfully","bit-integrations"));return}a(f(u({},t),{list:!1})),n.error(o("List refresh failed","bit-integrations"))})},k=e=>{const s=e==null?void 0:e.klaviyoFields.filter(t=>t.required===!0);return s.length>0?s.map(t=>({formField:"",klaviyoFormField:t.key})):[{formField:"",klaviyoFormField:""}]},h=e=>!((e!=null&&e.field_map?e.field_map.filter(t=>!t.formField||!t.klaviyoFormField||!t.formField==="custom"&&!t.customValue):[]).length>0),H=(e,s,t)=>{if(!h(e)){n.error("Please map mandatory fields");return}e.field_map.length>0&&s(t),document.querySelector(".btcd-s-wrp").scrollTop=0},I=(e,s,t,a,r,i)=>{i(!0),q(e,s,t,a,r,"","",i).then(l=>{var d;l.success?(n.success((d=l.data)==null?void 0:d.msg),r.push(t)):n.error(l.data||l)})},S=(e,s,t,a,r,i)=>{if(!h(t)){n.error("Please map mandatory fields");return}if(h(t)==="required"){n.error("You must select email or phone in klaviyo fields");return}A({flow:e,allIntegURL:s,conf:t,history:a,edit:r,setIsLoading:i})};export{M as a,I as b,w as e,k as g,x as h,H as n,S as s};
