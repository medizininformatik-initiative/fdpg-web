var y=Object.defineProperty;var N=Object.getOwnPropertySymbols;var $=Object.prototype.hasOwnProperty,M=Object.prototype.propertyIsEnumerable;var v=(i,l,e)=>l in i?y(i,l,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[l]=e,p=(i,l)=>{for(var e in l||(l={}))$.call(l,e)&&v(i,e,l[e]);if(N)for(var e of N(l))M.call(l,e)&&v(i,e,l[e]);return i};import{j as s,L}from"./main.js";import{b as _,_ as n,h as q,B as R,a8 as T}from"./bi-490-178.js";import{h as V,a as k}from"./bi-266-720.js";import{T as O}from"./bi-422-718.js";import{S as D}from"./bi-652-725.js";import{T as I}from"./bi-528-726.js";const Q=(i,l,e,a,d)=>{a(!0),_({},"refresh_news_letter").then(r=>{if(r&&r.success){const h=p({},l);h.default||(h.default={}),r.data.newsletterList&&(h.default.newsletterList=r.data.newsletterList),d({show:!0,msg:n("Newsletter list refreshed","bit-integrations")}),e(p({},h))}else r&&r.data&&r.data.data||!r.success&&typeof r.data=="string"?d({show:!0,msg:`${n("Newsletter list refresh failed Cause:","bit-integrations")}${r.data.data||r.data}. ${n("please try again","bit-integrations")}`}):d({show:!0,msg:n("Newsletter list refresh failed. please try again","bit-integrations")});a(!1)}).catch(()=>a(!1))},B=(i,l,e,a)=>{_({},"mail_poet_list_headers").then(d=>{if(d&&d.success){const r=p({},i);if(d.data.mailPoetFields){r.default.fields=d.data.mailPoetFields;const{fields:h}=r.default;r.field_map=Object.values(h).filter(b=>b.required).map(b=>({formField:"",mailPoetField:b.id,required:!0})),a({show:!0,msg:n("Mailpoet fields refreshed","bit-integrations")})}else a({show:!0,msg:n("No Mailpoet fields found. Try changing the header row number or try again","bit-integrations")});d.data.tokenDetails&&(r.tokenDetails=d.data.tokenDetails),l(p({},r))}else a({show:!0,msg:n("Mailpoet fields refresh failed. please try again","bit-integrations")});e(!1)}).catch(()=>e(!1))},U=(i,l,e)=>{const a=p({},l);a.name=i.target.value,e(p({},a))},W=i=>!((i!=null&&i.field_map?i.field_map.filter(e=>!e.formField&&e.mailPoetField&&e.required):[]).length>0);function E({i,formFields:l,field:e,mailPoetConf:a,setMailPoetConf:d}){var o,f,w,F;const r=e.required,h=((o=a==null?void 0:a.default)==null?void 0:o.fields)&&Object.values((f=a==null?void 0:a.default)==null?void 0:f.fields).filter(t=>t.required===""),b=q(R),{isPro:x}=b,c=t=>{const m=p({},a);m.field_map.splice(t,0,{}),d(m)},u=t=>{const m=p({},a);m.field_map.length>1&&m.field_map.splice(t,1),d(m)},j=(t,m)=>{const g=p({},a);g.field_map[m][t.target.name]=t.target.value,t.target.value==="custom"&&(g.field_map[m].customValue=""),d(g)};return s.jsxs("div",{className:"flx mt-2 mb-2 btcbi-field-map",children:[s.jsxs("div",{className:"flx integ-fld-wrp",children:[s.jsxs("select",{className:"btcd-paper-inp mr-2",name:"formField",value:e.formField||"",onChange:t=>j(t,i),children:[s.jsx("option",{value:"",children:n("Select Field","bit-integrations")}),s.jsx("optgroup",{label:"Form Fields",children:l==null?void 0:l.map(t=>s.jsx("option",{value:t.name,children:t.label},`ff-rm-${t.name}`))}),s.jsx("option",{value:"custom",children:n("Custom...","bit-integrations")}),s.jsx("optgroup",{label:`General Smart Codes ${x?"":"(PRO)"}`,children:x&&((w=D)==null?void 0:w.map(t=>s.jsx("option",{value:t.name,children:t.label},`ff-rm-${t.name}`)))})]}),e.formField==="custom"&&s.jsx(I,{onChange:t=>V(t,i,a,d),label:n("Custom Value","bit-integrations"),className:"mr-2",type:"text",value:e.customValue,placeholder:n("Custom Value","bit-integrations"),formFields:l}),s.jsxs("select",{className:"btcd-paper-inp",name:"mailPoetField",value:e.mailPoetField,onChange:t=>j(t,i),disabled:r,children:[s.jsx("option",{value:"",children:n("Select Field","bit-integrations")}),r?((F=a==null?void 0:a.default)==null?void 0:F.fields)&&Object.values(a.default.fields).map(t=>s.jsx("option",{value:t.id,children:t.name},`${t.id}-1`)):h&&h.map(t=>s.jsx("option",{value:t.id,children:t.name},`${t.id}-1`))]})]}),!r&&s.jsxs(s.Fragment,{children:[s.jsx("button",{onClick:()=>c(i),className:"icn-btn sh-sm ml-2 mr-1",type:"button",children:"+"}),s.jsx("button",{onClick:()=>u(i),className:"icn-btn sh-sm ml-2",type:"button","aria-label":"btn",children:s.jsx(O,{})})]})]})}function X({formID:i,formFields:l,mailPoetConf:e,setMailPoetConf:a,isLoading:d,setIsLoading:r,setSnackbar:h}){var x;const b=c=>{const u=p({},e);c?(u.lists=c?c.split(","):[],B(u,a,r,h)):delete u.lists,a(p({},u))};return s.jsxs(s.Fragment,{children:[s.jsx("br",{}),s.jsxs("div",{className:"flx",children:[s.jsx("b",{className:"wdt-200 d-in-b",children:n("List: ","bit-integrations")}),s.jsx(T,{defaultValue:e==null?void 0:e.lists,className:"btcd-paper-drpdwn w-6",options:((x=e==null?void 0:e.default)==null?void 0:x.newsletterList)&&Object.keys(e.default.newsletterList).map(c=>({label:e.default.newsletterList[c].newsletterName,value:e.default.newsletterList[c].newsletterId})),onChange:c=>b(c)}),s.jsx("button",{onClick:()=>b(i),className:"icn-btn sh-sm ml-2 mr-2 tooltip",style:{"--tooltip-txt":`'${n("Refresh MailPoet List","bit-integrations")}'`},type:"button",disabled:d,children:"â†»"})]}),d&&s.jsx(L,{style:{display:"flex",justifyContent:"center",alignItems:"center",height:100,transform:"scale(0.7)"}}),(e==null?void 0:e.lists)&&s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"mt-4",children:s.jsx("b",{className:"wdt-100",children:n("Map Fields","bit-integrations")})}),s.jsx("div",{className:"btcd-hr mt-1"}),s.jsxs("div",{className:"flx flx-around mt-2 mb-2 btcbi-field-map-label",children:[s.jsx("div",{className:"txt-dp",children:s.jsx("b",{children:n("Form Fields","bit-integrations")})}),s.jsx("div",{className:"txt-dp",children:s.jsx("b",{children:n("MailPoet Fields","bit-integrations")})})]}),e.field_map.map((c,u)=>s.jsx(E,{i:u,field:c,mailPoetConf:e,formFields:l,setMailPoetConf:a},`mailpoet-m-${u+9}`)),s.jsx("div",{className:"txt-center btcbi-field-map-button mt-2",children:s.jsx("button",{onClick:()=>k(e.field_map.length,e,a),className:"icn-btn sh-sm",type:"button",children:"+"})}),s.jsx("br",{}),s.jsx("br",{})]})]})}export{X as M,W as c,U as h,Q as r};
