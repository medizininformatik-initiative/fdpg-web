var $=Object.defineProperty,k=Object.defineProperties;var q=Object.getOwnPropertyDescriptors;var w=Object.getOwnPropertySymbols;var O=Object.prototype.hasOwnProperty,A=Object.prototype.propertyIsEnumerable;var M=(s,d,e)=>d in s?$(s,d,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[d]=e,h=(s,d)=>{for(var e in d||(d={}))O.call(d,e)&&M(s,e,d[e]);if(w)for(var e of w(d))A.call(d,e)&&M(s,e,d[e]);return s},R=(s,d)=>k(s,q(d));import{j as a,L as V}from"./main.js";import{b as N,_ as c,a7 as y,h as E,B as D,a8 as H}from"./bi-490-178.js";import{h as B,a as P}from"./bi-266-720.js";import{T as G}from"./bi-422-718.js";import{S as z}from"./bi-652-725.js";import{T as I}from"./bi-528-726.js";const J=(s,d,e,t,n)=>{t(!0),N({},"refresh_fluent_crm_lists").then(i=>{if(i&&i.success){const o=h({},d);o.default||(o.default={}),i.data.fluentCrmList&&(o.default.fluentCrmList=i.data.fluentCrmList),i.data.fluentCrmTags&&(o.default.fluentCrmTags=i.data.fluentCrmTags),n({show:!0,msg:c("FluentCRM list refreshed","bit-integrations")}),T(o,e,t,n)}else i&&i.data&&i.data.data||!i.success&&typeof i.data=="string"?n({show:!0,msg:`${c("FluentCRM list refresh failed Cause:","bit-integrations")}${i.data.data||i.data}. ${c("please try again","bit-integrations")}`}):n({show:!0,msg:c("FluentCRM list refresh failed. please try again","bit-integrations")});t(!1)}).catch(()=>t(!1))},K=(s,d,e,t,n)=>{t(!0),N({},"refresh_fluent_crm_tags").then(i=>{if(i&&i.success){const o=h({},d);o.default||(o.default={}),i.data.fluentCrmTags&&(o.default.fluentCrmTags=i.data.fluentCrmTags),n({show:!0,msg:c("FluentCRM Tags refreshed","bit-integrations")}),T(o,e,t,n)}else i&&i.data&&i.data.data||!i.success&&typeof i.data=="string"?n({show:!0,msg:`${c("FluentCRM tags refresh failed Cause:","bit-integrations")}${i.data.data||i.data}. ${c("please try again","bit-integrations")}`}):n({show:!0,msg:c("FluentCRM tags refresh failed. please try again","bit-integrations")});t(!1)}).catch(()=>t(!1))},T=(s,d,e,t)=>{N({},"fluent_crm_headers").then(n=>{if(n&&n.success){const i=h({},s);n.data.fluentCrmFlelds?(i.default.fields=n.data.fluentCrmFlelds,i.field_map=L(s),t({show:!0,msg:c("Fluent CRM fields refreshed","bit-integrations")})):t({show:!0,msg:c("No Fluent CRM fields found. Try changing the header row number or try again","bit-integrations")}),d(h({},i))}else t({show:!0,msg:c("Fluent CRM fields refresh failed. please try again","bit-integrations")});e(!1)}).catch(()=>e(!1))},L=s=>{const{field_map:d}=s,{fields:e}=s.default,n=Object.values(e).filter(p=>p.required).map(p=>({formField:"",fluentCRMField:p.key,required:!0})).filter(p=>!d.find(g=>g.fluentCRMField===p.fluentCRMField)),o=d.filter(p=>p.fluentCRMField||p.formField).map(p=>{const g=e[p.fluentCRMField];return g?R(h({},p),{formField:g.label}):p});return[...n,...o]},ee=(s,d,e)=>{const t=h({},d);t.name=s.target.value,e(h({},t))},ae=s=>!((s!=null&&s.field_map?s.field_map.filter(e=>!e.formField&&e.fluentCRMField&&e.required):[]).length>0);function Q({fluentCrmConf:s,setFluentCrmConf:d,formFields:e}){var n,i;const t=(o,p)=>{const g=h({},s);p==="exists"&&(o.target.checked?g.actions.skip_if_exists=!0:delete g.actions.skip_if_exists),p==="doubleOpIn"&&(o.target.checked?g.actions.double_opt_in=!0:delete g.actions.double_opt_in),d(h({},g))};return a.jsxs("div",{className:"pos-rel d-flx w-8",children:[a.jsx(y,{checked:((n=s.actions)==null?void 0:n.skip_if_exists)||!1,onChange:o=>t(o,"exists"),className:"wdt-200 mt-4 mr-2",value:"skip_if_exists",title:c("Skip exist Contact","bit-integrations"),subTitle:c("Skip if contact already exist in FluentCRM","bit-integrations")}),a.jsx(y,{checked:((i=s.actions)==null?void 0:i.double_opt_in)||!1,onChange:o=>t(o,"doubleOpIn"),className:"wdt-200 mt-4 mr-2",value:"double_opt_in",title:c("Double Opt-in","bit-integrations"),subTitle:c("Enable Double Option for new contacts","bit-integrations")})]})}function S({i:s,formFields:d,field:e,fluentCrmConf:t,setFluentCrmConf:n}){var u,r,b,j;const i=e.required,o=((u=t==null?void 0:t.default)==null?void 0:u.fields)&&Object.values((r=t==null?void 0:t.default)==null?void 0:r.fields).filter(l=>!l.required),p=E(D),{isPro:g}=p,F=l=>{const m=h({},t);m.field_map.splice(l,0,{}),n(m)},v=l=>{const m=h({},t);m.field_map.length>1&&m.field_map.splice(l,1),n(m)},x=(l,m)=>{const _=h({},t);_.field_map[m][l.target.name]=l.target.value,l.target.value==="custom"&&(_.field_map[m].customValue=""),n(_)};return a.jsxs("div",{className:"flx mt-2 mb-2 btcbi-field-map",children:[a.jsxs("div",{className:"flx integ-fld-wrp",children:[a.jsxs("select",{className:"btcd-paper-inp mr-2",name:"formField",value:e.formField||"",onChange:l=>x(l,s),children:[a.jsx("option",{value:"",children:c("Select Field","bit-integrations")}),a.jsx("optgroup",{label:"Form Fields",children:d==null?void 0:d.map(l=>a.jsx("option",{value:l.name,children:l.label},`ff-rm-${l.name}`))}),a.jsx("option",{value:"custom",children:c("Custom...","bit-integrations")}),a.jsx("optgroup",{label:`General Smart Codes ${g?"":"(PRO)"}`,children:g&&((b=z)==null?void 0:b.map(l=>a.jsx("option",{value:l.name,children:l.label},`ff-rm-${l.name}`)))})]}),e.formField==="custom"&&a.jsx(I,{onChange:l=>B(l,s,t,n),label:c("Custom Value","bit-integrations"),className:"mr-2",type:"text",value:e.customValue,placeholder:c("Custom Value","bit-integrations"),formFields:d}),a.jsxs("select",{className:"btcd-paper-inp",name:"fluentCRMField",value:e.fluentCRMField,onChange:l=>x(l,s),disabled:i,children:[a.jsx("option",{value:"",children:c("Select Field","bit-integrations")}),i?((j=t==null?void 0:t.default)==null?void 0:j.fields)&&Object.values(t.default.fields).map(l=>a.jsx("option",{value:l.key,children:l.label},`${l.key}-1`)):o&&o.map(l=>a.jsx("option",{value:l.key,children:l.label},`${l.key}-1`))]})]}),!i&&a.jsxs(a.Fragment,{children:[a.jsx("button",{onClick:()=>F(s),className:"icn-btn sh-sm ml-2 mr-1",type:"button",children:"+"}),a.jsx("button",{onClick:()=>v(s),className:"icn-btn sh-sm ml-2",type:"button","aria-label":"btn",children:a.jsx(G,{})})]})]})}function te({formID:s,formFields:d,fluentCrmConf:e,setFluentCrmConf:t,isLoading:n,setIsLoading:i,setSnackbar:o}){var x,u;const p=r=>{const b=h({},e);r?b.tags=r?r.split(","):[]:delete b.tags,t(h({},b))},g=[{value:"add-tag",label:"Add tag to a user"},{value:"remove-tag",label:"Remove tag from a user"},{value:"add-user",label:"Add user to a list"},{value:"remove-user",label:"Remove user from a list"}],F=r=>{const b=h({},e);b.list_id=r.target.value,t(h({},b))},v=r=>{const b=h({},e),{name:j,value:l}=r.target;r.target.value!==""?(b[j]=l,t({name:"Fluent CRM",type:"Fluent Crm",actionName:l,field_map:[{formField:"",fluentCRMField:""}],actions:{}})):(delete b[j],t(h({},b)))};return a.jsxs(a.Fragment,{children:[a.jsx("br",{}),a.jsxs("div",{className:"flx",children:[a.jsx("b",{className:"wdt-200 d-in-b",children:c("Action:","bit-integrations")}),a.jsxs("select",{onChange:v,name:"actionName",value:e==null?void 0:e.actionName,className:"btcd-paper-inp w-5",children:[a.jsx("option",{value:"",children:c("Select Action","bit-integrations")}),g.map(({label:r,value:b})=>a.jsx("option",{value:b,children:r},r))]})]}),a.jsx("br",{}),((e==null?void 0:e.actionName)==="add-user"||(e==null?void 0:e.actionName)==="remove-user")&&a.jsxs("div",{className:"flx",children:[a.jsx("b",{className:"wdt-200 d-in-b",children:c("Fluent CRM List:","bit-integrations")}),a.jsxs("select",{onChange:r=>F(r),name:"list_id",value:e.list_id,className:"btcd-paper-inp w-5",children:[a.jsx("option",{value:"",children:c("Select Fluent CRM list","bit-integrations")}),((x=e==null?void 0:e.default)==null?void 0:x.fluentCrmList)&&Object.keys(e.default.fluentCrmList).map(r=>a.jsx("option",{value:e.default.fluentCrmList[r].id,children:e.default.fluentCrmList[r].title},r))]}),a.jsx("button",{onClick:()=>J(s,e,t,i,o),className:"icn-btn sh-sm ml-2 mr-2 tooltip",style:{"--tooltip-txt":`'${c("Refresh List, Tag & Field","bit-integrations")}'`},type:"button",disabled:n,children:"↻"})]}),(e==null?void 0:e.actionName)&&(e==null?void 0:e.actionName)!=="remove-user"&&a.jsxs("div",{className:"flx mt-5",children:[a.jsx("b",{className:"wdt-200 d-in-b",children:c("Fluent CRM Tags: ","bit-integrations")}),a.jsx(H,{defaultValue:e==null?void 0:e.tags,className:"btcd-paper-drpdwn w-5",options:((u=e==null?void 0:e.default)==null?void 0:u.fluentCrmTags)&&Object.keys(e.default.fluentCrmTags).map(r=>({label:e.default.fluentCrmTags[r].title,value:e.default.fluentCrmTags[r].id.toString()})),onChange:r=>p(r)}),a.jsx("button",{onClick:()=>K(s,e,t,i,o),className:"icn-btn sh-sm ml-2 mr-2 tooltip",style:{"--tooltip-txt":`'${c("Refresh Tag & Field","bit-integrations")}'`},type:"button",disabled:n,children:"↻"})]}),n&&a.jsx(V,{style:{display:"flex",justifyContent:"center",alignItems:"center",height:100,transform:"scale(0.7)"}}),a.jsx("div",{className:"mt-4",children:a.jsx("b",{className:"wdt-100",children:c("Map Fields","bit-integrations")})}),a.jsx("div",{className:"btcd-hr mt-1"}),a.jsxs("div",{className:"flx flx-around mt-2 mb-2 btcbi-field-map-label",children:[a.jsx("div",{className:"txt-dp",children:a.jsx("b",{children:c("Form Fields","bit-integrations")})}),a.jsx("div",{className:"txt-dp",children:a.jsx("b",{children:c("Fluent CRM Fields","bit-integrations")})})]}),e.field_map.map((r,b)=>a.jsx(S,{i:b,field:r,fluentCrmConf:e,formFields:d,setFluentCrmConf:t},`fluentcrm-m-${b+9}`)),(e==null?void 0:e.actionName)==="add-user"&&a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"txt-center btcbi-field-map-button mt-2",style:{marginRight:85},children:a.jsx("button",{onClick:()=>P(e.field_map.length,e,t),className:"icn-btn sh-sm",type:"button",children:"+"})}),a.jsx("br",{}),a.jsx("div",{className:"mt-4",children:a.jsx("b",{className:"wdt-100",children:c("Actions","bit-integrations")})}),a.jsx("div",{className:"btcd-hr mt-1"}),a.jsx(Q,{fluentCrmConf:e,setFluentCrmConf:t,setIsLoading:i,setSnackbar:o})]})]})}export{te as F,ae as c,ee as h,J as r};
